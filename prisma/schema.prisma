// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ—„ï¸ SCHEMA DE BASE DE DATOS - LIMA AIRPORT HOSTEL AI SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Sistema de gestiÃ³n de reservas con IA conversacional integrada
// Incluye: Subscribers, Conversaciones, Mensajes, Reservas y Habitaciones
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ‘¤ USUARIOS DEL SISTEMA (Dashboard Admin)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String
  role      UserRole @default(RECEPTIONIST)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

enum UserRole {
  ADMIN
  MANAGER
  RECEPTIONIST
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ‘¥ CLIENTES/HUÃ‰SPEDES (de ManyChat)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model Subscriber {
  id            String   @id @default(uuid())
  subscriberId  String   @unique // ID de ManyChat
  platform      Platform
  firstName     String?
  lastName      String?
  email         String?
  phone         String?
  tags          String[] // Tags de ManyChat
  customFields  Json? // Campos personalizados de ManyChat

  // ClasificaciÃ³n de huÃ©sped
  guestType     GuestType @default(NEW)
  priority      Priority @default(NORMAL)

  // Preferencias del huÃ©sped
  preferences   Json? // Preferencias de habitaciÃ³n, servicios, etc.

  // Metadata
  firstSeenAt   DateTime @default(now())
  lastActiveAt  DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relaciones
  conversations Conversation[]
  bookings      Booking[]

  @@map("subscribers")
  @@index([subscriberId])
  @@index([guestType])
  @@index([platform])
}

enum Platform {
  INSTAGRAM
  WHATSAPP
  FACEBOOK
  TELEGRAM
  EMAIL
  WEB
}

enum GuestType {
  NEW
  CONTACTED
  INTERESTED
  RESERVED
  CHECKED_IN
  CHECKED_OUT
  RETURNING
  VIP
}

enum Priority {
  LOW
  NORMAL
  HIGH
  URGENT
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ’¬ CONVERSACIONES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model Conversation {
  id           String   @id @default(uuid())
  subscriberId String
  subscriber   Subscriber @relation(fields: [subscriberId], references: [id], onDelete: Cascade)

  // Metadata de la conversaciÃ³n
  topic        String? // Tema principal identificado por IA (ej: "consulta de habitaciÃ³n", "reserva")
  sentiment    Sentiment? // Sentimiento general

  // Control
  isActive     Boolean  @default(true)
  startedAt    DateTime @default(now())
  endedAt      DateTime?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relaciones
  messages     Message[]

  @@map("conversations")
  @@index([subscriberId])
  @@index([isActive])
}

enum Sentiment {
  VERY_NEGATIVE
  NEGATIVE
  NEUTRAL
  POSITIVE
  VERY_POSITIVE
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“¨ MENSAJES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model Message {
  id             String   @id @default(uuid())
  conversationId String
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  // Tipo y contenido
  role           MessageRole
  messageType    MessageType
  content        String   @db.Text // Contenido principal (texto o transcripciÃ³n)

  // Archivos multimedia
  audioUrl       String? // URL del audio original
  imageUrl       String? // URL de la imagen original
  audioTranscription String? @db.Text // TranscripciÃ³n de audio
  imageAnalysis  Json? // AnÃ¡lisis de GPT-4 Vision

  // Metadata de IA
  aiAgent        String? // QuÃ© agente procesÃ³ esto
  aiConfidence   Float? // Confianza de la respuesta (0-1)
  processingTime Int? // Tiempo en ms

  // Timestamps
  createdAt      DateTime @default(now())

  @@map("messages")
  @@index([conversationId])
  @@index([createdAt])
}

enum MessageRole {
  USER      // Mensaje del huÃ©sped
  ASSISTANT // Respuesta del sistema
  SYSTEM    // Mensajes internos
}

enum MessageType {
  TEXT
  AUDIO
  IMAGE
  DOCUMENT
  LOCATION
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¨ TIPOS DE HABITACIONES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model RoomType {
  id            String   @id @default(uuid())
  name          String   @unique // "Individual con baÃ±o privado", "Doble con baÃ±o privado", etc.
  slug          String   @unique // "individual-bano-privado"
  description   String   @db.Text
  capacity      Int // NÃºmero de personas

  // Precios
  priceUSD      Decimal  @db.Decimal(10, 2)
  pricePEN      Decimal  @db.Decimal(10, 2)

  // CaracterÃ­sticas
  features      String[] // ["BaÃ±o privado", "WiFi", "TV", "Aire acondicionado"]
  images        String[] // URLs de imÃ¡genes de la habitaciÃ³n

  // Inventario
  totalRooms    Int // CuÃ¡ntas habitaciones de este tipo hay

  // Estado
  isActive      Boolean  @default(true)
  displayOrder  Int      @default(0)

  // Metadata
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relaciones
  bookings      Booking[]

  @@map("room_types")
  @@index([isActive])
  @@index([slug])
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“… RESERVAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model Booking {
  id            String   @id @default(uuid())
  bookingCode   String   @unique // RES-2025-001

  subscriberId  String
  subscriber    Subscriber @relation(fields: [subscriberId], references: [id])

  roomTypeId    String
  roomType      RoomType @relation(fields: [roomTypeId], references: [id])

  // Detalles de la reserva
  checkIn       DateTime
  checkOut      DateTime
  nights        Int
  guests        Int

  // Precios
  pricePerNight Decimal  @db.Decimal(10, 2)
  totalPrice    Decimal  @db.Decimal(10, 2)
  currency      String   @default("USD")

  // InformaciÃ³n del huÃ©sped
  guestName     String
  guestEmail    String?
  guestPhone    String?
  specialRequests String?  @db.Text

  // Estado
  status        BookingStatus @default(PENDING)
  paymentStatus PaymentStatus @default(PENDING)
  confirmedAt   DateTime?
  cancelledAt   DateTime?
  cancellationReason String?

  // IntegraciÃ³n con Google Calendar
  calendarEventId String? // ID del evento en Google Calendar

  // Metadata
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("bookings")
  @@index([subscriberId])
  @@index([status])
  @@index([checkIn])
  @@index([checkOut])
}

enum BookingStatus {
  PENDING      // Pendiente de confirmaciÃ³n
  CONFIRMED    // Confirmada
  CHECKED_IN   // HuÃ©sped en hotel
  CHECKED_OUT  // Checkout completado
  CANCELLED    // Cancelada
  NO_SHOW      // No se presentÃ³
}

enum PaymentStatus {
  PENDING
  PARTIAL
  PAID
  REFUNDED
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ§  MEMORIA DE AGENTES IA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model AgentMemory {
  id            String   @id @default(uuid())
  subscriberId  String
  agentType     AgentType

  // Contexto almacenado
  context       Json
  summary       String?  @db.Text

  // Metadata
  createdAt     DateTime @default(now())
  expiresAt     DateTime?

  @@map("agent_memory")
  @@unique([subscriberId, agentType])
  @@index([subscriberId, agentType])
  @@index([expiresAt])
}

enum AgentType {
  RECEPTIONIST    // Agente de recepciÃ³n
  CONCIERGE       // Agente de conserjerÃ­a
  SUPPORT         // Soporte tÃ©cnico
  EXTRACTED_DATA  // Datos extraÃ­dos de conversaciones (respaldo)
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“ˆ EVENTOS DE ANALYTICS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model AnalyticsEvent {
  id            String   @id @default(uuid())
  subscriberId  String?

  // Tipo de evento
  eventType     String
  eventCategory String

  // Datos del evento
  properties    Json

  // Metadata
  timestamp     DateTime @default(now())
  platform      Platform?
  userAgent     String?
  ipAddress     String?

  @@map("analytics_events")
  @@index([subscriberId])
  @@index([eventType])
  @@index([timestamp])
}
